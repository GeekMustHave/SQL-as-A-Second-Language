= SQL as a Second Language
John Schuster <John.schuster@PhoenixWorkgroup.com>
v2.1f, 12/28/2018: Training Document
:source-highlighter: coderay
:coderay-css: class
:coderay-linenums-mode: inline
:Author: John HR Schuster
:Company: Phoenix Learning Labs
:toc: left
:toclevels: 4:
:imagesdir: ./images
:pagenums:
:numbered: 
:chapter-label: 
:experimental:
:icons: font
:docodir: ./doco
:sqldir: ./SQL
:resultdir: ./Results
:github: https://github.com/GeekMustHave/SQL-as-Second-Language
:linkattrs:
:seclinks:
:title-logo-image: ./images/create-doco_optum-cover.png

SQL as a Second Language (SASL) was a course that I taught many moons ago.
It is being revisited now to help answer some SQL questions brought up by those whose are taking
their SQL Skills to the next level.

A PDF version of this web site is available at this link:readme.pdf[ Link, window="_blank"]

[[top]]
== Introduction

This SQL As a Second Language version will use the Teradata SQL syntax.

.Examples
[quote, Bruce Lee,]
A teacher, a really good teacher, is never a giver of truth; he is a guide, a pointer to truth

=== Chinook Database

The training database will be the Chinook database on music record sales.

Reference: https://github.com/lerocha/chinook-database


.Chinook Database Diagram
image::chinook-diagram.png[Chinook Database Diagram, align='center']
 

<<<< 
== Questions

To ask a *New question* to be added to this list, please email it to john.schuster@PhoenixWorkgroup.com. 

[qanda]
How can I get a count of the number of rows in some of the tables of a database?::
  View this query <<tableCounts>>

How can a get a list of the objects (Tables, View, Procedures) for a specific database?::
  View This query <<dbObjects>>

How can I find out the columns and metadata about a specific object (Table, View)?::   
  View this query <<tableColumns>>

How can I find where a specific column exist in a database?::
  View this query <<findColumn>>

How do I Join two tables together?::
  View this query <<joinQueryPartB>>  

How do I restrict the results by a column that `contains` some string?::
    View this query <<joinQueryPartC>>  

How do I sort the results by multiple columns?::
    View this query <<joinQueryPartC>>      

How can I best use "Prompts" in SQL Assistant?::
  unlinked


== Queries

<<<<
[[tableCounts]]
=== tableCounts

.SQL Example
[source,sql,linenums]
----
include::{sqldir}/0001-tableCounts.sql[]
----
<1> First query in union determine sizes and names of columns.
<2> count(*)  is an aggregate function
<3> Order by can be by the ordinal number of the column (Column 1 is tableName, Column 2 is Rows)

SQL download link link:{sqldir}/0001-tableCounts.sql[ click here]

.Results
[options='header']
,===
include::{resultdir}/0001-tableCounts.csv[results]
,===

Back to <<top>>.


<<<<
[[dbObjects]]
=== dbObjects

.SQL Example
[source,sql,linenums]
----
include::{sqldir}/0002-dbObjects.sql[]
----

SQL download link link:{sqldir}/0002-dbObjects.sql[ click here]

.Results
[options='header']
,===
include::{resultdir}/0002-dbObjects.csv[results]
,===

Back to <<top>>.


<<<<
[[tableColumns]]
=== tableColumns
  
.SQL Example
[source,sql,linenums]
----
include::{sqldir}/0003-TableColumns.sql[]
----
 
SQL Download link link:{sqldir}/0003-TableColumns.sql[ click here]
 
.Results
[options='header']
,===
include::{resultdir}/0003-tableColumns.csv[Results]
,===

NOTE: ColumnType defined the data type of a column.
Reference: <<ColumnType>>
 
Back to <<top>>.
 

<<<<
[[findColumn]]
=== findColumn
  
.SQL Example
[source,sql,linenums]
----
include::{sqldir}/0004-findColumns.sql[]
----
 
SQL Download link link:{sqldir}/0004-findColumns.sql[ click here]
 
.Results
[options='header']
,===
include::{resultdir}/0004-findColumns.csv[Results]
,===
 
NOTE: The ColumnType identifies the data type of the column.
Reference: <<Column Type>>

Back to <<top>>.
 

<<<<
[[joinQueryPartA]]
=== joinQuery Part A

*Objective:* Get a list of tracks from the *Artist* `Aerosmith` 
where the *Composer* is `Joe Perry`.

*Approach:* Begin with a simple query to get one element of the objective.
In this query we want to get the *ArtistID* for `Aerosmith`
  
.SQL Example
[source,sql,linenums]
----
include::{sqldir}/0005a-joinQuery.sql[]
----
<1> Column alias, notice name is `artistName` 
<2> Table alias, use alias on every instance of columns from that table
 
SQL Download link link:{sqldir}/0005a-joinQuery.sql[ click here]
 
.Results
[options='header']
,===
include::{resultdir}/0005a-joinQuery.csv[Results]
,===
 
Back to <<top>>.
 
 
<<<<
[[joinQueryPartB]]
=== joinQuery Part B


*Objective:* Get a list of tracks from the *Artist* `Aerosmith` 
where the *Composer* is `Joe Perry`.

*Approach:* Add on to the initial query to get a list of all the *Albums* for the *Artist* `Aerosmith`
  
.SQL Example
[source,sql,linenums]
----
include::{sqldir}/0005b-joinQuery.sql[]
----
<1> Column alias, notice name is `artistName` 
<2> Table alias, use alias on every instance of columns from that table
<3> The common column used to join the two tables together
 
SQL Download link link:{sqldir}/0005b-joinQuery.sql[ click here]
 
.Results
[options='header']
,===
include::{resultdir}/0005b-joinQuery.csv[Results]
,===
 
Back to <<top>>.

<<<<
[[joinQueryPartC]]
=== joinQuery Part C

*Objective:* Get a list of tracks from the *Artist* `Aerosmith` 
where the *Composer* is `Joe Perry`.

*Approach:* Complete the request by joining the `Title` table and a row restriction
using the `like` with the wildcard `%` character.
  
  
.SQL Example
[source,sql,linenums]
----
include::{sqldir}/0005c-joinQuery.sql[]
----
<1> Column alias, notice name is `artistName` 
<2> Table alias, use alias on every instance of columns from that table
<3> The common column used to join the two tables together
<4> The `like` with wildcard character `%` used on `Composer` column
<5> The order by has both actual column name `AL.AlbumTitle` and
an alias column `trackName`
<6> Shows alternative method of `order by` using ordinal column numbers
 
SQL Download link link:{sqldir}/0005c-joinQuery.sql[ click here]
 
.Results
[cols="^2,^2,^2,4,4,4,6" options='header']
,===
include::{resultdir}/0005c-joinQuery.csv[Results]
,===
 
Back to <<top>>.
 

<<<<
[[derivedTablePartA]]
=== derivedTable Part A

*Objective:* Get a list by Artist that includes number of albums, number of tracks, total artist minutes and average minutes per track.

*Approach:* Use a set of derived queries to get the parts of the request and assemble them in the main query.

NOTE: This request could be done using a single query.  The derived tables are being used here, 
to show how they can be used to build parts of the results, that are assembled in a main query later.

This query gets the album count by artist.
  
  
.SQL Example
[source,sql,linenums]
----
include::{sqldir}/0006a-derivedTable.sql[]
----
<1> Column Alias
<2> Aggregate `Count` function
<3> Table alias
<4> Common column to join two tables
<5> Any non-aggregate column must be included in `group by`
 
SQL Download link link:{sqldir}/0006a-derivedTable.sql[ click here]
 
.Results
[cols="10,10" options='header']
,===
include::{resultdir}/0006a-derivedTable.csv[Results,lines=1..20]
,===

NOTE: Only 20 rows of the result being shown.  The result set has 204 rows, one for each artist.
 
Back to <<top>>.
 
 
 




 
<<<<
== Reference



=== Column Type

ColumnType reference table.

.ColumnType
[cols="^3,8" options='header']
,===
include::{docodir}/column-type.csv[ColumnType]
,===

 

 




<<<<
== Document History

.Document History
[cols='2,2,2,6' options='header']
|===
| Date  | Version | Author | Description
| 12/28/2018 | V2.1f | JHRS | Added derivedQuery from archived
| 12/27/2018 | V2.1e | JHRS | Added joinQuery set from archive
| 12/21/2018 | V2.1d | JHRS | Added vsCode snippet for quick query insert
                              added Reference section
| 12/20/2018 | V2.1c | JHRS | Attempting standard document template
| 12/17/2018 | V2.1b | JHRS |  Initial version
|===




////
Internal Document notes:

1. The SQL included code will not have line numbers, this is ok.

2. Use the SQL callout syntax --<1> at the end of line, then add <1> This is what this does under the SQL code block

3. Use directives for documents (docdir), SQL folder (sqldir} and Results folder {resultdir}, this allows for better separation os objects and allows for libraries to be redirected.

4. Because of section numbering the standard section link <<section>> doesn't work.  So section headers that need to be an anchor need to have a [[section]] above the section




////



